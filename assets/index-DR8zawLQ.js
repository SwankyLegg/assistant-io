(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const g={IDLE:"IDLE",LISTENING:"LISTENING",THINKING:"THINKING",RESPONDING:"RESPONDING"},m=window.SpeechRecognition||window.webkitSpeechRecognition,L={onListenStart:void 0,onListenEnd:void 0,onRecognitionResult:void 0,onVoiceStart:void 0,onVoiceEnd:void 0,onError:void 0,synthesis:{pitch:1,rate:1},recognition:{continuous:!0,interimResults:!0,lang:"en-US",maxAlternatives:3},onLanguagesLoaded:void 0,onVoicesLoaded:void 0};class E{constructor(e={}){if(this.states=g,this.state=g.IDLE,this.recognitionResults=[],this.accumulatedTranscript="",this.selectedVoice=null,this.voices=[],this.voicesLoaded=!1,this.recognitionLanguages=[{code:"en-US",name:"English"},{code:"es-ES",name:"Español"},{code:"fr-FR",name:"Français"},{code:"de-DE",name:"Deutsch"},{code:"it-IT",name:"Italiano"},{code:"ja-JP",name:"日本語"},{code:"ko-KR",name:"한국어"},{code:"zh-CN",name:"中文"}],!("SpeechRecognition"in window)&&!("webkitSpeechRecognition"in window))throw new Error("Speech recognition is not supported in this browser");if(!("speechSynthesis"in window))throw new Error("Speech synthesis is not supported in this browser");this.states=g,this.state=this.states.IDLE,this.config={...L,synthesis:{...L.synthesis,...e.synthesis},recognition:{...L.recognition,...e.recognition},...e},this.selectedLanguage=this.config.recognition.lang,this.initRecognizer(),this.synthesizer=window.speechSynthesis,this.synthesizer.onvoiceschanged=()=>{this.voices=this.synthesizer.getVoices(),this.handleVoicesLoaded()},this.voices=this.synthesizer.getVoices(),this.handleVoicesLoaded(),window.addEventListener("beforeunload",()=>this.cleanup())}initRecognizer(){if(!m)throw new Error("Speech recognition not supported");this.recognizer=new m,Object.assign(this.recognizer,this.config.recognition),this.recognizer.onstart=()=>{var e,n;(n=(e=this.config).onListenStart)==null||n.call(e)},this.recognizer.onresult=e=>this.handleRecognitionResult(e),this.recognizer.onspeechend=()=>{this.recognizer.stop()},this.recognizer.onend=()=>{var e,n;(n=(e=this.config).onListenEnd)==null||n.call(e)},this.recognizer.onerror=e=>{this.handleError(e,"recognizer")}}handleVoicesLoaded(){var n,i,t,s,c,r;this.voicesLoaded=!0,this.voices=this.synthesizer.getVoices();const e=this.getAvailableLanguages();if((i=(n=this.config).onLanguagesLoaded)==null||i.call(n,e),e.length>0){const l=e.some(o=>o.code===this.selectedLanguage);if(!this.selectedLanguage||!l)this.setLanguage(e[0].code);else{const o=this.getVoicesForCurrentLanguage();o.length>0&&!this.selectedVoice&&this.setVoice(o[0].name),(s=(t=this.config).onVoicesLoaded)==null||s.call(t,o)}}else(r=(c=this.config).onVoicesLoaded)==null||r.call(c,[])}handleRecognitionResult(e){var s,c;const n=Array.from(e.results).map(r=>Array.from(r).map(l=>({transcript:l.transcript,confidence:l.confidence,isFinal:r.isFinal}))),i=n.map(r=>r.reduce((l,o)=>o.confidence>l.confidence?o:l)).map(r=>r.transcript).join(" "),t=n[n.length-1];t&&t[0].isFinal&&(this.accumulatedTranscript=(this.accumulatedTranscript+" "+i).trim(),this.stopRecognizing(),this.state=this.states.IDLE),this.recognitionResults=n,(c=(s=this.config).onRecognitionResult)==null||c.call(s,n,i,this.accumulatedTranscript)}setIdle(){this.cleanup()}setListening(){this.state===g.RESPONDING?this.stopSpeaking():this.cleanup(),this.accumulatedTranscript="",this.recognizer.start()}setThinking(){this.cleanup()}setSpeaking(e){this.cleanup();const n=new SpeechSynthesisUtterance(e);Object.assign(n,this.config.synthesis),this.selectedVoice?(n.voice=this.selectedVoice,n.lang=this.selectedVoice.lang):n.lang=this.selectedLanguage,n.onend=()=>{var i,t;this.setState(g.IDLE),(t=(i=this.config).onVoiceEnd)==null||t.call(i,n)},n.onstart=()=>{var i,t;(t=(i=this.config).onVoiceStart)==null||t.call(i,n)},n.onerror=i=>{this.handleError(i,"utterance")},this.synthesizer.speak(n)}setState(e,n){if(!(e in g))throw new Error(`Invalid state: ${e}`);if(this.state===e)return console.log("No Voice I/O state change");switch(this.state=e,e){case g.IDLE:return this.setIdle();case g.RESPONDING:return this.setSpeaking(n);case g.LISTENING:return this.setListening();case g.THINKING:return this.setThinking()}}handleError(e,n){var i,t;console.info(`Voice I/O ${n} error`,e),(t=(i=this.config).onError)==null||t.call(i,e),this.stopRecognizing(),this.setState(g.IDLE)}stopRecognizing(){if(this.recognizer)try{this.recognizer.stop()}catch(e){console.warn("Error stopping recognition:",e)}}stopSpeaking(){this.synthesizer.speaking&&this.synthesizer.cancel()}cleanup(){try{this.stopSpeaking(),this.stopRecognizing()}catch(e){this.handleError(e,"cleanup")}}getVoices(){return this.voices}getState(){return this.state}setLanguage(e){var i,t;this.selectedLanguage=e,this.config.recognition.lang=e;const n=this.getVoicesForCurrentLanguage();this.selectedVoice=null,this.config.synthesis.voice=void 0,n.length>0&&this.setVoice(n[0].name),(t=(i=this.config).onVoicesLoaded)==null||t.call(i,n),this.initRecognizer()}getVoicesForCurrentLanguage(){const e=this.selectedLanguage.split("-")[0].toLowerCase();return this.voices.filter(n=>n.lang.split("-")[0].toLowerCase()===e)}setVoice(e){const i=this.getVoicesForCurrentLanguage().find(t=>t.name===e);i?(this.selectedVoice=i,this.config.synthesis.voice=i):console.warn("Selected voice is not available for current language")}getSelectedLanguage(){return this.selectedLanguage}getSelectedVoice(){return this.selectedVoice}getAvailableLanguages(){const e=this.synthesizer.getVoices();if(e.length>0&&(this.voices=e),!this.voices||this.voices.length===0)return[];const n=new Set(this.voices.map(i=>i.lang.split("-")[0].toLowerCase()));return this.recognitionLanguages.filter(i=>{const t=i.code.split("-")[0].toLowerCase();return n.has(t)}).map(i=>({code:i.code,name:i.name,prefix:i.code.split("-")[0].toLowerCase()}))}}function p(u){return u.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#finalTranscript");const u=document.querySelector("#interimTranscript"),e=document.querySelector("#currentState"),n=document.querySelector("#toggleMic");function i(o,a,d){console.info("handleRecognitionResult",o,a,d);const f=o[o.length-1][0],S=document.querySelector("#transcript");S.textContent=f.isFinal?d:a,S.classList.toggle("interim",!f.isFinal),f.isFinal&&console.log("Final result:",{transcript:d,confidence:f.confidence})}const t=document.getElementById("languageSelect"),s=document.getElementById("voiceSelect");t.disabled=!0,t.innerHTML="<option>Loading languages...</option>",s.disabled=!0,s.innerHTML="<option>Loading voices...</option>";const c=new E({onListenStart:()=>{console.log("Started listening..."),e.textContent=p(c.states.LISTENING),n.textContent="Stop"},onListenEnd:()=>{console.log("Stopped listening"),e.textContent=p(c.states.IDLE),n.textContent="Listen",u.textContent=""},onRecognitionResult:i,onVoiceStart:()=>{console.log("Started speaking"),e.textContent=p(c.states.RESPONDING),r.textContent="Stop"},onVoiceEnd:o=>{console.log("Finished speaking:",o.text),e.textContent=p(c.states.IDLE),r.textContent="Speak"},onError:o=>{console.error("Voice I/O error:",o),e.textContent="Error",n.textContent="Listen"},onLanguagesLoaded:o=>{if(console.log("Languages loaded:",o),t.innerHTML="",o.length===0){t.innerHTML="<option>Default</option>",t.disabled=!0;return}t.disabled=!1,o.forEach(d=>{const h=document.createElement("option");h.value=d.code,h.textContent=`${d.name} (${d.code})`,t.appendChild(h)});const a=c.getSelectedLanguage();a&&(t.value=a)},onVoicesLoaded:o=>{if(console.log("Voices loaded:",o),s.innerHTML="",o.length===0){s.innerHTML="<option>Default</option>",s.disabled=!0;return}s.disabled=!1,o.forEach(d=>{const h=document.createElement("option");h.value=d.name,h.textContent=`${d.name} (${d.lang})`,s.appendChild(h)});const a=c.getSelectedVoice();a&&(s.value=a.name)}}),r=document.querySelector("#speakButton"),l=document.querySelector("#responseInput");r.addEventListener("click",()=>{l.value===""&&(l.value="Hello world"),c.setState(c.states.RESPONDING,l.value)}),n.addEventListener("click",()=>{c.state===c.states.LISTENING?c.setState(c.states.IDLE):c.setState(c.states.LISTENING)}),t.addEventListener("change",o=>{const a=o.target.value;a&&(s.disabled=!0,s.innerHTML="<option>Loading voices...</option>",c.setLanguage(a))}),s.addEventListener("change",o=>{const a=o.target.value;a&&c.setVoice(a)}),n.textContent="Listen",r.textContent="Speak",e.textContent=p(c.states.IDLE)});
