(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const l={IDLE:"IDLE",LISTENING:"LISTENING",THINKING:"THINKING",RESPONDING:"RESPONDING"},m=window.SpeechRecognition||window.webkitSpeechRecognition,L={onListenStart:void 0,onListenEnd:void 0,onRecognitionResult:void 0,onVoiceStart:void 0,onVoiceEnd:void 0,onError:void 0,synthesis:{pitch:1,rate:1},recognition:{continuous:!0,interimResults:!0,lang:"en-US",maxAlternatives:3},onLanguagesLoaded:void 0,onVoicesLoaded:void 0};class E{constructor(e={}){if(this.states=l,this.state=l.IDLE,this.recognitionResults=[],this.accumulatedTranscript="",this.selectedVoice=null,this.voices=[],this.voicesLoaded=!1,this.recognitionLanguages=[{code:"en-US",name:"English"},{code:"es-ES",name:"Español"},{code:"fr-FR",name:"Français"},{code:"de-DE",name:"Deutsch"},{code:"it-IT",name:"Italiano"},{code:"ja-JP",name:"日本語"},{code:"ko-KR",name:"한국어"},{code:"zh-CN",name:"中文"}],!("SpeechRecognition"in window)&&!("webkitSpeechRecognition"in window))throw new Error("Speech recognition is not supported in this browser");if(!("speechSynthesis"in window))throw new Error("Speech synthesis is not supported in this browser");this.states=l,this.state=this.states.IDLE,this.config={...L,synthesis:{...L.synthesis,...e.synthesis},recognition:{...L.recognition,...e.recognition},...e},this.selectedLanguage=this.config.recognition.lang,this.initRecognizer(),this.synthesizer=window.speechSynthesis,this.voices=this.synthesizer.getVoices(),this.voices.length>0&&this.handleVoicesLoaded(),this.synthesizer.onvoiceschanged!==void 0&&(this.synthesizer.onvoiceschanged=()=>{this.voices=this.synthesizer.getVoices(),!this.voicesLoaded&&this.voices.length>0&&this.handleVoicesLoaded()}),window.addEventListener("beforeunload",()=>this.cleanup())}initRecognizer(){if(!m)throw new Error("Speech recognition not supported");this.recognizer=new m,Object.assign(this.recognizer,this.config.recognition),this.recognizer.onstart=()=>{var e,t;(t=(e=this.config).onListenStart)==null||t.call(e)},this.recognizer.onresult=e=>this.handleRecognitionResult(e),this.recognizer.onspeechend=()=>{this.recognizer.stop()},this.recognizer.onend=()=>{var e,t;(t=(e=this.config).onListenEnd)==null||t.call(e)},this.recognizer.onerror=e=>{this.handleError(e,"recognizer")}}handleVoicesLoaded(){var t,i,n,o;this.voicesLoaded=!0;const e=this.getAvailableLanguages();if(e.length>0){const s=e.some(r=>r.code===this.selectedLanguage);if(!this.selectedLanguage||!s)this.setLanguage(e[0].code);else{const r=this.getVoicesForCurrentLanguage();r.length>0&&!this.selectedVoice&&this.setVoice(r[0].name),(i=(t=this.config).onVoicesLoaded)==null||i.call(t,r)}(o=(n=this.config).onLanguagesLoaded)==null||o.call(n,e)}}handleRecognitionResult(e){var o,s;const t=Array.from(e.results).map(r=>Array.from(r).map(d=>({transcript:d.transcript,confidence:d.confidence,isFinal:r.isFinal}))),i=t.map(r=>r.reduce((d,c)=>c.confidence>d.confidence?c:d)).map(r=>r.transcript).join(" "),n=t[t.length-1];n&&n[0].isFinal&&(this.accumulatedTranscript=(this.accumulatedTranscript+" "+i).trim(),this.stopRecognizing(),this.state=this.states.IDLE),this.recognitionResults=t,(s=(o=this.config).onRecognitionResult)==null||s.call(o,t,i,this.accumulatedTranscript)}setIdle(){this.cleanup()}setListening(){this.state===l.RESPONDING?this.stopSpeaking():this.cleanup(),this.accumulatedTranscript="",this.recognizer.start()}setThinking(){this.cleanup()}setSpeaking(e){this.cleanup();const t=new SpeechSynthesisUtterance(e);Object.assign(t,this.config.synthesis),this.selectedVoice?(t.voice=this.selectedVoice,t.lang=this.selectedVoice.lang):t.lang=this.selectedLanguage,t.onend=()=>{var i,n;this.setState(l.IDLE),(n=(i=this.config).onVoiceEnd)==null||n.call(i,t)},t.onstart=()=>{var i,n;(n=(i=this.config).onVoiceStart)==null||n.call(i,t)},t.onerror=i=>{this.handleError(i,"utterance")},this.synthesizer.speak(t)}setState(e,t){if(!(e in l))throw new Error(`Invalid state: ${e}`);if(this.state===e)return console.log("No Voice I/O state change");switch(this.state=e,e){case l.IDLE:return this.setIdle();case l.RESPONDING:return this.setSpeaking(t);case l.LISTENING:return this.setListening();case l.THINKING:return this.setThinking()}}handleError(e,t){var i,n;console.info(`Voice I/O ${t} error`,e),(n=(i=this.config).onError)==null||n.call(i,e),this.stopRecognizing(),this.setState(l.IDLE)}stopRecognizing(){if(this.recognizer)try{this.recognizer.stop()}catch(e){console.warn("Error stopping recognition:",e)}}stopSpeaking(){this.synthesizer.speaking&&this.synthesizer.cancel()}cleanup(){try{this.stopSpeaking(),this.stopRecognizing()}catch(e){this.handleError(e,"cleanup")}}getVoices(){return this.voices}getState(){return this.state}setLanguage(e){var i,n;this.selectedLanguage=e,this.config.recognition.lang=e;const t=this.getVoicesForCurrentLanguage();this.selectedVoice=null,this.config.synthesis.voice=void 0,t.length>0&&this.setVoice(t[0].name),(n=(i=this.config).onVoicesLoaded)==null||n.call(i,t),this.initRecognizer()}getVoicesForCurrentLanguage(){const e=this.selectedLanguage.split("-")[0].toLowerCase();return this.voices.filter(t=>t.lang.split("-")[0].toLowerCase()===e)}setVoice(e){const i=this.getVoicesForCurrentLanguage().find(n=>n.name===e);i?(this.selectedVoice=i,this.config.synthesis.voice=i):console.warn("Selected voice is not available for current language")}getSelectedLanguage(){return this.selectedLanguage}getSelectedVoice(){return this.selectedVoice}getAvailableLanguages(){if(!this.voices||this.voices.length===0)return[];const e=new Set(this.voices.map(t=>t.lang.split("-")[0].toLowerCase()));return this.recognitionLanguages.filter(t=>{const i=t.code.split("-")[0].toLowerCase();return e.has(i)}).map(t=>({code:t.code,name:t.name,prefix:t.code.split("-")[0].toLowerCase()}))}}function u(h){return h.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#finalTranscript");const h=document.querySelector("#interimTranscript"),e=document.querySelector("#currentState"),t=document.querySelector("#toggleMic");function i(c,g,a){console.info("handleRecognitionResult",c,g,a);const f=c[c.length-1][0],S=document.querySelector("#transcript");S.textContent=f.isFinal?a:g,S.classList.toggle("interim",!f.isFinal),f.isFinal&&console.log("Final result:",{transcript:a,confidence:f.confidence})}const n=document.getElementById("languageSelect"),o=document.getElementById("voiceSelect");n.disabled=!0,o.disabled=!0;const s=new E({onListenStart:()=>{console.log("Started listening..."),e.textContent=u(s.states.LISTENING),t.textContent="Stop"},onListenEnd:()=>{console.log("Stopped listening"),e.textContent=u(s.states.IDLE),t.textContent="Listen",h.textContent=""},onRecognitionResult:i,onVoiceStart:()=>{console.log("Started speaking"),e.textContent=u(s.states.RESPONDING),r.textContent="Stop"},onVoiceEnd:c=>{console.log("Finished speaking:",c.text),e.textContent=u(s.states.IDLE),r.textContent="Speak"},onError:c=>{console.error("Voice I/O error:",c),e.textContent="Error",t.textContent="Listen"},onLanguagesLoaded:c=>{console.log("Languages loaded:",c),n.innerHTML="",n.disabled=!c.length,c.forEach(g=>{const a=document.createElement("option");a.value=g.code,a.textContent=`${g.name} (${g.code})`,n.appendChild(a)}),n.value=s.getSelectedLanguage()},onVoicesLoaded:c=>{console.log("Voices loaded:",c),o.innerHTML="",o.disabled=!c.length,c.forEach(a=>{const p=document.createElement("option");p.value=a.name,p.textContent=`${a.name} (${a.lang})`,o.appendChild(p)});const g=s.getSelectedVoice();g&&(o.value=g.name)}}),r=document.querySelector("#speakButton"),d=document.querySelector("#responseInput");r.addEventListener("click",()=>{d.value===""&&(d.value="Hello world"),s.setState(s.states.RESPONDING,d.value)}),t.addEventListener("click",()=>{s.state===s.states.LISTENING?s.setState(s.states.IDLE):s.setState(s.states.LISTENING)}),n.addEventListener("change",c=>{s.setLanguage(c.target.value)}),o.addEventListener("change",c=>{s.setVoice(c.target.value)}),t.textContent="Listen",r.textContent="Speak",e.textContent=u(s.states.IDLE)});
