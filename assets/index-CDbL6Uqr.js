(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();const d={onListenStart:null,onListenEnd:null,onRecognitionResult:null,onVoiceStart:null,onVoiceEnd:null,onError:null,synthesis:{pitch:1,rate:1},recognition:{continuous:!0,interimResults:!0,lang:"en-US",maxAlternatives:3}},a={IDLE:"IDLE",LISTENING:"LISTENING",THINKING:"THINKING",RESPONDING:"RESPONDING"};class f{constructor(e={}){if(!("SpeechRecognition"in window)&&!("webkitSpeechRecognition"in window))throw new Error("Speech recognition is not supported in this browser");if(!("speechSynthesis"in window))throw new Error("Speech synthesis is not supported in this browser");this.states=a,this.state=this.states.IDLE,this.config={...d,synthesis:{...d.synthesis,...e.synthesis},recognition:{...d.recognition,...e.recognition},...e},this.initRecognizer(),this.initSynthesizer(),window.addEventListener("beforeunload",()=>this.cleanup()),this.recognitionResults=[],this.accumulatedTranscript=""}initRecognizer(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)throw new Error("Speech recognition not supported");this.recognizer=new e,Object.assign(this.recognizer,this.config.recognition),this.recognizer.onstart=()=>{var n,s;(s=(n=this.config).onListenStart)==null||s.call(n)},this.recognizer.onresult=n=>this.handleRecognitionResult(n),this.recognizer.onspeechend=()=>{this.recognizer.stop()},this.recognizer.onend=()=>{var n,s;(s=(n=this.config).onListenEnd)==null||s.call(n)},this.recognizer.onerror=n=>{this.handleError(n,"recognizer")}}initSynthesizer(){this.synthesizer=window.speechSynthesis,this.voices=[];const e=()=>{this.voices=this.synthesizer.getVoices()};e(),this.synthesizer.onvoiceschanged!==void 0&&(this.synthesizer.onvoiceschanged=e)}handleRecognitionResult(e){var i,r;const n=Array.from(e.results).map(o=>Array.from(o).map(c=>({transcript:c.transcript,confidence:c.confidence,isFinal:o.isFinal}))),s=n.map(o=>o.reduce((c,h)=>h.confidence>c.confidence?h:c)).map(o=>o.transcript).join(" "),t=n[n.length-1];t&&t[0].isFinal&&(this.accumulatedTranscript=(this.accumulatedTranscript+" "+s).trim(),this.stopRecognizing(),this.state=this.states.IDLE),this.recognitionResults=n,(r=(i=this.config).onRecognitionResult)==null||r.call(i,n,s,this.accumulatedTranscript)}setIdle(){this.cleanup()}setListening(){this.state===a.RESPONDING?this.stopSpeaking():this.cleanup(),this.accumulatedTranscript="",this.recognizer.start()}setThinking(){this.cleanup()}setSpeaking(e){this.cleanup();const n=new SpeechSynthesisUtterance(e);if(Object.assign(n,this.config.synthesis),this.config.synthesis.voice){const s=this.voices.find(t=>t.name===this.config.synthesis.voice);s&&(n.voice=s)}n.onend=()=>{var s,t;this.setState(a.IDLE),(t=(s=this.config).onVoiceEnd)==null||t.call(s,n)},n.onstart=()=>{var s,t;(t=(s=this.config).onVoiceStart)==null||t.call(s,n)},n.onerror=s=>{this.handleError(s,"utterance")},this.synthesizer.speak(n)}setState(e,n){if(!this.states[e])throw new Error(`Invalid state: ${e}`);if(this.state===e)return console.log("No Assistant state change");switch(this.state=e,e){case a.IDLE:return this.setIdle();case a.RESPONDING:return this.setSpeaking(n);case a.LISTENING:return this.setListening();case a.THINKING:return this.setThinking()}}handleError(e,n){var s,t;console.info(`Assistant ${n} error`,e),(t=(s=this.config).onError)==null||t.call(s,e),this.stopRecognizing(),this.setState(a.IDLE)}stopRecognizing(){if(this.recognizer)try{this.recognizer.stop()}catch(e){console.warn("Error stopping recognition:",e)}}stopSpeaking(){this.synthesizer.speaking&&this.synthesizer.cancel()}cleanup(){try{this.stopSpeaking(),this.stopRecognizing()}catch(e){this.handleError(e,"cleanup")}}getVoices(){return this.voices}getState(){return this.state}}function u(l){return l.toLowerCase().replace(/\b\w/g,e=>e.toUpperCase())}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#finalTranscript");const l=document.querySelector("#interimTranscript"),e=document.querySelector("#currentState"),n=document.querySelector("#toggleMic");function s(o,c,h){console.info("handleRecognitionResult",o,c,h);const g=o[o.length-1][0],p=document.querySelector("#transcript");p.textContent=g.isFinal?h:c,p.classList.toggle("interim",!g.isFinal),g.isFinal&&console.log("Final result:",{transcript:h,confidence:g.confidence})}const t=new f({onListenStart:()=>{console.log("Started listening..."),e.textContent=u(t.states.LISTENING),n.textContent="Stop"},onListenEnd:()=>{console.log("Stopped listening"),e.textContent=u(t.states.IDLE),n.textContent="Listen",l.textContent=""},onRecognitionResult:s,onVoiceStart:()=>{console.log("Started speaking"),e.textContent=u(t.states.RESPONDING),i.textContent="Stop"},onVoiceEnd:o=>{console.log("Finished speaking:",o.text),e.textContent=u(t.states.IDLE),i.textContent="Speak"},onError:o=>{console.error("Assistant error:",o),e.textContent="Error",n.textContent="Listen"}}),i=document.querySelector("#speakButton"),r=document.querySelector("#responseInput");i.addEventListener("click",()=>{r.value===""&&(r.value="Hello world"),t.setState(t.states.RESPONDING,r.value)}),n.addEventListener("click",()=>{t.state===t.states.LISTENING?t.setState(t.states.IDLE):t.setState(t.states.LISTENING)}),n.textContent="Listen",i.textContent="Speak",e.textContent=u(t.states.IDLE)});
