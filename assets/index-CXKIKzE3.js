(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const f={onListenStart:null,onListenEnd:null,onRecognitionResult:null,onVoiceStart:null,onVoiceEnd:null,onError:null,synthesis:{pitch:1,rate:1},recognition:{continuous:!0,interimResults:!0,lang:"en-US",maxAlternatives:3},onLanguagesLoaded:null,onVoicesLoaded:null},h={IDLE:"IDLE",LISTENING:"LISTENING",THINKING:"THINKING",RESPONDING:"RESPONDING"};class m{constructor(t={}){if(!("SpeechRecognition"in window)&&!("webkitSpeechRecognition"in window))throw new Error("Speech recognition is not supported in this browser");if(!("speechSynthesis"in window))throw new Error("Speech synthesis is not supported in this browser");this.states=h,this.state=this.states.IDLE,this.config={...f,synthesis:{...f.synthesis,...t.synthesis},recognition:{...f.recognition,...t.recognition},...t},this.recognitionResults=[],this.accumulatedTranscript="",this.recognitionLanguages=[{code:"en-US",name:"English"},{code:"es-ES",name:"Español"},{code:"fr-FR",name:"Français"},{code:"de-DE",name:"Deutsch"},{code:"it-IT",name:"Italiano"},{code:"ja-JP",name:"日本語"},{code:"ko-KR",name:"한국어"},{code:"zh-CN",name:"中文"}],this.selectedLanguage=this.config.recognition.lang,this.selectedVoice=null,this.voices=[],this.voicesLoaded=!1,this.initRecognizer(),this.synthesizer=window.speechSynthesis,this.voices=this.synthesizer.getVoices(),this.voices.length>0&&this.handleVoicesLoaded(),this.synthesizer.onvoiceschanged!==void 0&&(this.synthesizer.onvoiceschanged=()=>{this.voices=this.synthesizer.getVoices(),!this.voicesLoaded&&this.voices.length>0&&this.handleVoicesLoaded()}),window.addEventListener("beforeunload",()=>this.cleanup())}initRecognizer(){const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)throw new Error("Speech recognition not supported");this.recognizer=new t,Object.assign(this.recognizer,this.config.recognition),this.recognizer.onstart=()=>{var e,i;(i=(e=this.config).onListenStart)==null||i.call(e)},this.recognizer.onresult=e=>this.handleRecognitionResult(e),this.recognizer.onspeechend=()=>{this.recognizer.stop()},this.recognizer.onend=()=>{var e,i;(i=(e=this.config).onListenEnd)==null||i.call(e)},this.recognizer.onerror=e=>{this.handleError(e,"recognizer")}}handleVoicesLoaded(){var e,i,n,o;this.voicesLoaded=!0;const t=this.getAvailableLanguages();if(t.length>0){const s=t.some(r=>r.code===this.selectedLanguage);if(!this.selectedLanguage||!s)this.setLanguage(t[0].code);else{const r=this.getVoicesForCurrentLanguage();r.length>0&&!this.selectedVoice&&this.setVoice(r[0].name),(i=(e=this.config).onVoicesLoaded)==null||i.call(e,r)}(o=(n=this.config).onLanguagesLoaded)==null||o.call(n,t)}}handleRecognitionResult(t){var o,s;const e=Array.from(t.results).map(r=>Array.from(r).map(l=>({transcript:l.transcript,confidence:l.confidence,isFinal:r.isFinal}))),i=e.map(r=>r.reduce((l,c)=>c.confidence>l.confidence?c:l)).map(r=>r.transcript).join(" "),n=e[e.length-1];n&&n[0].isFinal&&(this.accumulatedTranscript=(this.accumulatedTranscript+" "+i).trim(),this.stopRecognizing(),this.state=this.states.IDLE),this.recognitionResults=e,(s=(o=this.config).onRecognitionResult)==null||s.call(o,e,i,this.accumulatedTranscript)}setIdle(){this.cleanup()}setListening(){this.state===h.RESPONDING?this.stopSpeaking():this.cleanup(),this.accumulatedTranscript="",this.recognizer.start()}setThinking(){this.cleanup()}setSpeaking(t){this.cleanup();const e=new SpeechSynthesisUtterance(t);Object.assign(e,this.config.synthesis),this.selectedVoice?(e.voice=this.selectedVoice,e.lang=this.selectedVoice.lang):e.lang=this.selectedLanguage,e.onend=()=>{var i,n;this.setState(h.IDLE),(n=(i=this.config).onVoiceEnd)==null||n.call(i,e)},e.onstart=()=>{var i,n;(n=(i=this.config).onVoiceStart)==null||n.call(i,e)},e.onerror=i=>{this.handleError(i,"utterance")},this.synthesizer.speak(e)}setState(t,e){if(!this.states[t])throw new Error(`Invalid state: ${t}`);if(this.state===t)return console.log("No Voice I/O state change");switch(this.state=t,t){case h.IDLE:return this.setIdle();case h.RESPONDING:return this.setSpeaking(e);case h.LISTENING:return this.setListening();case h.THINKING:return this.setThinking()}}handleError(t,e){var i,n;console.info(`Voice I/O ${e} error`,t),(n=(i=this.config).onError)==null||n.call(i,t),this.stopRecognizing(),this.setState(h.IDLE)}stopRecognizing(){if(this.recognizer)try{this.recognizer.stop()}catch(t){console.warn("Error stopping recognition:",t)}}stopSpeaking(){this.synthesizer.speaking&&this.synthesizer.cancel()}cleanup(){try{this.stopSpeaking(),this.stopRecognizing()}catch(t){this.handleError(t,"cleanup")}}getVoices(){return this.voices}getState(){return this.state}setLanguage(t){var i,n;this.selectedLanguage=t,this.config.recognition.lang=t;const e=this.getVoicesForCurrentLanguage();this.selectedVoice=null,this.config.synthesis.voice=null,e.length>0&&this.setVoice(e[0].name),(n=(i=this.config).onVoicesLoaded)==null||n.call(i,e),this.initRecognizer()}getVoicesForCurrentLanguage(){const t=this.selectedLanguage.split("-")[0].toLowerCase();return this.voices.filter(e=>e.lang.split("-")[0].toLowerCase()===t)}setVoice(t){const i=this.getVoicesForCurrentLanguage().find(n=>n.name===t);i?(this.selectedVoice=i,this.config.synthesis.voice=i):console.warn("Selected voice is not available for current language")}getSelectedLanguage(){return this.selectedLanguage}getSelectedVoice(){return this.selectedVoice}getAvailableLanguages(){if(!this.voices||this.voices.length===0)return[];const t=new Set(this.voices.map(e=>e.lang.split("-")[0].toLowerCase()));return this.recognitionLanguages.filter(e=>{const i=e.code.split("-")[0].toLowerCase();return t.has(i)}).map(e=>({code:e.code,name:e.name,prefix:e.code.split("-")[0].toLowerCase()}))}}function u(d){return d.toLowerCase().replace(/\b\w/g,t=>t.toUpperCase())}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("#finalTranscript");const d=document.querySelector("#interimTranscript"),t=document.querySelector("#currentState"),e=document.querySelector("#toggleMic");function i(c,g,a){console.info("handleRecognitionResult",c,g,a);const L=c[c.length-1][0],S=document.querySelector("#transcript");S.textContent=L.isFinal?a:g,S.classList.toggle("interim",!L.isFinal),L.isFinal&&console.log("Final result:",{transcript:a,confidence:L.confidence})}const n=document.getElementById("languageSelect"),o=document.getElementById("voiceSelect");n.disabled=!0,o.disabled=!0;const s=new m({onListenStart:()=>{console.log("Started listening..."),t.textContent=u(s.states.LISTENING),e.textContent="Stop"},onListenEnd:()=>{console.log("Stopped listening"),t.textContent=u(s.states.IDLE),e.textContent="Listen",d.textContent=""},onRecognitionResult:i,onVoiceStart:()=>{console.log("Started speaking"),t.textContent=u(s.states.RESPONDING),r.textContent="Stop"},onVoiceEnd:c=>{console.log("Finished speaking:",c.text),t.textContent=u(s.states.IDLE),r.textContent="Speak"},onError:c=>{console.error("Voice I/O error:",c),t.textContent="Error",e.textContent="Listen"},onLanguagesLoaded:c=>{console.log("Languages loaded:",c),n.innerHTML="",n.disabled=!c.length,c.forEach(g=>{const a=document.createElement("option");a.value=g.code,a.textContent=`${g.name} (${g.code})`,n.appendChild(a)}),n.value=s.getSelectedLanguage()},onVoicesLoaded:c=>{console.log("Voices loaded:",c),o.innerHTML="",o.disabled=!c.length,c.forEach(a=>{const p=document.createElement("option");p.value=a.name,p.textContent=`${a.name} (${a.lang})`,o.appendChild(p)});const g=s.getSelectedVoice();g&&(o.value=g.name)}}),r=document.querySelector("#speakButton"),l=document.querySelector("#responseInput");r.addEventListener("click",()=>{l.value===""&&(l.value="Hello world"),s.setState(s.states.RESPONDING,l.value)}),e.addEventListener("click",()=>{s.state===s.states.LISTENING?s.setState(s.states.IDLE):s.setState(s.states.LISTENING)}),n.addEventListener("change",c=>{s.setLanguage(c.target.value)}),o.addEventListener("change",c=>{s.setVoice(c.target.value)}),e.textContent="Listen",r.textContent="Speak",t.textContent=u(s.states.IDLE)});
